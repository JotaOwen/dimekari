class Message
  constructor: (Taringa) ->
    @taringa = Taringa

  get: (id, callback) ->
    self = @
    @taringa.request.get "http://www.taringa.net/mensajes/leer/#{id}", (err, resp, body) ->
      console.log ("http://www.taringa.net/mensajes/leer/#{id}")
      if !err
        data = body.match(/<div class=\"clearfix\">\s+<h2 class=\"floatL\">(.*?)<\/h2>\s+<\/div>\s+<div id=\"print-mensaje\">\s+<div class=\"comment clearfix\">\s+<div class=\"comment-data\">\s+<a href=\".*?\" class=\"min-avatar\">\s+<img src=\".*?\" class=\"avatar-48\">\s+<\/a>\s+<\/div>\s+<div class=\"comment-text\">\s+<div class=\"comment-author clearfix\">\s+@<a class="hovercard" data-uid="\d+" href=".*?">(.*?)<\/a>\s+<span class="subtext">\s+<span ts="(\d+)" title=".*?".*?<\/span>\s+<\/span>\s+<div class="comment-content">([\s\S]+)<\/div>\s+<\/div>\s+<\/div>\s+<\/div>\s+<\/div>\s+<div id=\"print-conversation\">/)
        if data?
          callback.call this, false, data
        else
          callback.call this, 'Messsage::get It is not a message'
      else
        callback.call this, 'Messsage::get Request was not succesful'

  getLast: (callback) ->
    self = @
    @taringa.request.get "http://www.taringa.net/mensajes/recibidos/pagina1", (err, resp, body) ->
      if !err
        data = body.match(/<div class=\"m-opciones .*?\">\s+<input id=\"(\d+)\" name=\"\d+\" type=\"checkbox\" class/)
        if data?
          callback.call this, false, data[1]
        else
          callback.call this, 'Messsage::get It is not a message'
      else
        callback.call this, 'Messsage::get Request was not succesful'

module.exports = Message