class User
  constructor: (Taringa) ->
    @taringa = Taringa

  follow: (user_id) ->
    self = @
    @taringa.request.post 'http://www.taringa.net/notificaciones-ajax.php', { form:
      key: self.taringa.user_key
      type: 'user'
      obj: user_id
      action: 'follow' }, (error, response, body) ->
        if error or response.statusCode isnt 200
          self.taringa.log 'User::follow -> Error al seguir al usuario'
  
  unfollow: (user_id) ->
    self = @
    @taringa.request.post 'http://www.taringa.net/notificaciones-ajax.php', { form:
      key: self.taringa.user_key
      type: 'user'
      obj: user_id
      action: 'unfollow' }, (error, response, body) ->
        if error or response.statusCode isnt 200
          self.taringa.log 'User::follow -> Error al dejar de seguir al usuario'

  get_user_id_from_nick: (nick, callback) ->
    self = @
    @taringa.request 'http://api.taringa.net/user/nick/view/' + nick, (error, response, body) ->
      if !error and response.statusCode is 200
        data = JSON.parse(body)
        callback.call this, false, data['id']
      else
        callback.call this, 'User::get_user_id_from_nick Request was not succesful'

  send_pm: (nick, subject, body) ->
    self = @
    @taringa.request.post 'http://www.taringa.net/ajax/mp/compose', {
      form:
      msgSubject: subject,
      msgText: body,
      msgTo: nick,
      captcha: '',
      recaptcha: ''
      key: self.taringa.user_key }, (err, res, body) ->
        if err or res.statusCode isnt 200
          self.taringa.log 'User::send_pm -> Error al enviar el mensaje'

module.exports = User